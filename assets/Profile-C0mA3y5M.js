import{b as K,i as J,j as a,c as je,d as P,t as L,s as q,r as l,e as I,a as D,I as Y,F as Z,f as Ee,S as Pe,M as De,u as ye,g as ee,T as ze,P as pe,h as he,B as U}from"./index-CTuUUjIM.js";import{d as k,L as Me,A as Oe,D as _e,v as $e,s as F,p as ge}from"./main-D4x9Xeqy.js";import{v as b,d as ve,a as Ce}from"./validate-BfdLEKTZ.js";import{I as me}from"./InputAdornment-CzCEp_rC.js";import{R as Te,a as xe}from"./RadioGroup-DoMDEEtj.js";import"./visuallyHidden-Dan1xhjv.js";var se={},ke=J;Object.defineProperty(se,"__esModule",{value:!0});var R=se.default=void 0,Le=ke(K()),qe=a;R=se.default=(0,Le.default)((0,qe.jsx)("path",{d:"M20 1v3h3v2h-3v3h-2V6h-3V4h3V1zm-8 12c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m2-9.75V7h3v3h2.92c.05.39.08.79.08 1.2 0 3.32-2.67 7.25-8 11.8-5.33-4.55-8-8.48-8-11.8C4 6.22 7.8 3 12 3c.68 0 1.35.08 2 .25"}),"AddLocationAlt");var ae={},He=J;Object.defineProperty(ae,"__esModule",{value:!0});var W=ae.default=void 0,Ue=He(K()),Re=a;W=ae.default=(0,Ue.default)((0,Re.jsx)("path",{d:"M21 12.4V7l-4-4H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h7.4zM15 15c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3M6 6h9v4H6zm13.99 10.25 1.77 1.77L16.77 23H15v-1.77zm3.26.26-.85.85-1.77-1.77.85-.85c.2-.2.51-.2.71 0l1.06 1.06c.2.2.2.52 0 .71"}),"SaveAs");async function Ye(e,u,C,m){var c;let h=C;if(!((c=e.fieldChangedSet)!=null&&c.size))return null;const t=Array.from(e.fieldChangedSet),s=t.reduce((d,o)=>{let i=`set${je(o)}`,p=o;if(o==="password")return d;if(o==="firstName"&&(p="name"),o==="email"&&(i="changeEmail"),o==="dateOfBirth")return[...d,{action:i,[o]:e.date.value.format("YYYY-MM-DD")}];const f=e[p];return[...d,{action:i,[o]:f.value}]},[]);let n=await P.updateUserData(s,u,h);if((n==null?void 0:n.statusCode)===200){L("User data updated");const d=n==null?void 0:n.body;h=d.version,m(q({user:d}))}if(!t.includes("password")||!e.oldPassword)return n;if(n=await P.updatePassword({version:h,currentPassword:e.oldPassword,newPassword:e.password.value}),(n==null?void 0:n.statusCode)===200){L("User password updated");const d=await P.loginUser(e.email.value,e.password.value);(d==null?void 0:d.statusCode)===200&&m(q({user:d.body.customer}))}return n}var te={},Fe=J;Object.defineProperty(te,"__esModule",{value:!0});var B=te.default=void 0,Ge=Fe(K()),We=a;B=te.default=(0,Ge.default)((0,We.jsx)("path",{d:"m17.66 9.53-7.07 7.07-4.24-4.24 1.41-1.41 2.83 2.83 5.66-5.66zM4 12c0-2.33 1.02-4.42 2.62-5.88L9 8.5v-6H3l2.2 2.2C3.24 6.52 2 9.11 2 12c0 5.19 3.95 9.45 9 9.95v-2.02c-3.94-.49-7-3.86-7-7.93m18 0c0-5.19-3.95-9.45-9-9.95v2.02c3.94.49 7 3.86 7 7.93 0 2.33-1.02 4.42-2.62 5.88L15 15.5v6h6l-2.2-2.2c1.96-1.82 3.2-4.41 3.2-7.3"}),"PublishedWithChanges");var V=(e=>(e.firstName="firstName",e.lastName="lastName",e.email="email",e.dateOfBirth="dateOfBirth",e.defaultShippingAddress="defaultShippingAddress",e.defaultBillingAddress="defaultBillingAddress",e.city="city",e.country="country",e.postalCode="postalCode",e.streetName="streetName",e))(V||{});const Ke={email:{value:"",isValid:!1},password:{value:"",isValid:!1},name:{value:"",isValid:!1},lastName:{value:"",isValid:!1},date:{value:k(""),isValid:!1},billingStreet:{value:"",isValid:!1},shippingStreet:{value:"",isValid:!1},billingCity:{value:"",isValid:!1},shippingCity:{value:"",isValid:!1},billingCode:{value:"",isValid:!1},shippingCode:{value:"",isValid:!1},billingCountry:{value:"",isValid:!1},shippingCountry:{value:"",isValid:!1},fieldChangedSet:new Set,fieldChangedSetAddr:new Set,defaultBillingAddressId:"",defaultShippingAddressId:"",oldPassword:"",addresses:[]},Je=l.createContext(Ke),A=Je;function Qe({dateProps:e}){k.locale("ru");const u=k().subtract(15,"y"),[C,m]=l.useState(!0),[h,t]=l.useState(""),s=l.useContext(A),n=I(f=>f.auth.user),[c,d]=l.useState(s.date.value),[o,i]=l.useState(!1);l.useEffect(()=>{if(n&&typeof n.dateOfBirth=="string"){const f=k(n.dateOfBirth);s.date.value=f,d(f),i(!1)}else s.date.value=k("");m(!0)},[n,s.date]),l.useEffect(()=>{c&&(s.date.value=c)},[e.isDisable]),l.useEffect(()=>{var f,r,j;if(e.isDisable&&(n!=null&&n.dateOfBirth)){const y=k(n.dateOfBirth);d(y),i(!1),(f=s.fieldChangedSet)==null||f.delete(V.dateOfBirth)}else if(!e.isDisable){const y=C&&s.date.value.format("YYYY-MM-DD")!==(n==null?void 0:n.dateOfBirth);i(y),y?(r=s.fieldChangedSet)==null||r.add(V.dateOfBirth):(j=s.fieldChangedSet)==null||j.delete(V.dateOfBirth)}},[e.isDisable,C,n==null?void 0:n.dateOfBirth,s]);function p(f){if(!f)return;e.isChange(!0);const r=$e(f),j=!r;m(j),t(r),j&&f?(s.date.value=f,s.date.isValid=!0,i(f.format("YYYY-MM-DD")!==(n==null?void 0:n.dateOfBirth))):(s.date.isValid=!1,i(!1)),d(f),e.isChange(!1)}return a.jsxs("div",{className:"field-wrap",children:[a.jsx(Me,{dateAdapter:Oe,adapterLocale:"ru",children:a.jsx(_e,{className:"input-field-profile",disabled:e.isDisable,value:c,label:"Date of birth",required:!0,maxDate:u,helperText:C?"":h,FormHelperTextProps:{sx:{color:"red"}},size:"small",onChange:f=>p(f)})}),o&&a.jsx(B,{className:"change-icon"})]})}function Xe({isDisable:e}){const[u,C]=l.useState(!0),[m,h]=l.useState(""),t=l.useContext(A),s=I(i=>i.auth.user),[n,c]=l.useState(t.email.value);l.useEffect(()=>(s&&(t.email.value=s.email,c(s.email)),()=>{t.email.value=""}),[s,t.email]),l.useEffect(()=>{var p,f;e&&(s!=null&&s.email)&&c(s.email),n!==(s==null?void 0:s.email)?(p=t.fieldChangedSet)==null||p.add(V.email):(f=t.fieldChangedSet)==null||f.delete(V.email)},[e,n,s==null?void 0:s.email,t.fieldChangedSet]);function d(i){c(i);const p=b("email",i),f=!p;C(f),h(p),f&&i.length>1?(t.email.value=i,t.email.isValid=!0):t.email.isValid=!1}const o=n!==(s==null?void 0:s.email);return a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{className:"input-field-profile",disabled:e,value:n,type:"email",id:"email",label:"Email",autoComplete:"off",required:!0,helperText:u?"":m,FormHelperTextProps:{sx:{color:"red"}},color:u?"primary":"error",size:"small",onChange:i=>d(i.target.value)}),o&&a.jsx(B,{className:"change-icon"})]})}function Ze({isDisable:e}){const[u,C]=l.useState(!0),[m,h]=l.useState(""),t=l.useContext(A),s=I(i=>i.auth.user),[n,c]=l.useState(t.name.value);l.useEffect(()=>(s&&typeof s.firstName=="string"&&(t.name.value=s.firstName,c(s.firstName)),()=>{t.name.value=""}),[s,t.name]),l.useEffect(()=>{var p,f;e&&(s!=null&&s.firstName)&&c(s.firstName),n!==(s==null?void 0:s.firstName)?(p=t.fieldChangedSet)==null||p.add(V.firstName):(f=t.fieldChangedSet)==null||f.delete(V.firstName)},[e,n,s==null?void 0:s.firstName,t.fieldChangedSet]);function d(i){c(i),C(!b("name",i)),h(b("name",i)),b("name",i)?t.name.isValid=!1:(c(i),t.name.value=i,t.name.isValid=!0)}const o=n!==(s==null?void 0:s.firstName);return a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{disabled:e,value:n,className:"input-field-profile",id:"first_name",label:"First Name",autoComplete:"off",type:"Text",required:!0,helperText:u?"":m,FormHelperTextProps:{sx:{color:"red"}},color:u?"primary":"error",size:"small",onChange:i=>d(i.target.value)}),o&&a.jsx(B,{className:"change-icon"})]})}function es({isDisable:e}){const[u,C]=l.useState(!0),[m,h]=l.useState(""),t=l.useContext(A),s=I(i=>i.auth.user),[n,c]=l.useState(t.lastName.value);l.useEffect(()=>(s&&typeof s.lastName=="string"&&(t.lastName.value=s.lastName,c(s.lastName)),()=>{t.lastName.value=""}),[s,t.lastName]),l.useEffect(()=>{var i,p;e&&(s!=null&&s.lastName)&&c(s.lastName),n===(s==null?void 0:s.lastName)?(i=t.fieldChangedSet)==null||i.delete(V.lastName):(p=t.fieldChangedSet)==null||p.add(V.lastName)},[e,n,s==null?void 0:s.lastName,t.fieldChangedSet]);function d(i){c(i),C(!b("lastName",i)),h(b("lastName",i)),b("lastName",i)?t.lastName.isValid=!1:(t.lastName.value=i,t.lastName.isValid=!0)}const o=n!==(s==null?void 0:s.lastName);return a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{className:"input-field-profile",disabled:e,value:n,id:"last_name",label:"Last Name",autoComplete:"off",type:"Text",helperText:u?"":m,FormHelperTextProps:{sx:{color:"red"}},color:u?"primary":"error",required:!0,size:"small",onChange:i=>d(i.target.value)}),o&&a.jsx(B,{className:"change-icon"})]})}function ss({isDisable:e}){const[u,C]=l.useState(!1),[m,h]=l.useState(!1),[t,s]=l.useState(!0),[n,c]=l.useState(""),[d,o]=l.useState(""),i=l.useContext(A),[p,f]=l.useState(""),r=()=>{C(v=>!v)},j=()=>{h(v=>!v)};l.useEffect(()=>{i.oldPassword="",i.password.value="",i.password.isValid=!1,s(!0),o(""),c("")},[e]),l.useEffect(()=>{var E,S;!!n&&i.password.value&&i.password.isValid&&i.password.value!==n?(E=i.fieldChangedSet)==null||E.add("password"):(S=i.fieldChangedSet)==null||S.delete("password")},[i.password.isValid,e,i.fieldChangedSet,n,d]);function y(v){o(v),s(!b("password",v)),f(b("password",v)),!b("password",v)&&v.length>1?(i.password.value=v,i.password.isValid=!0):i.password.isValid=!1}const z=n!==d&&i.password.isValid&&n&&d;return!e&&a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{autoComplete:"off",style:{marginBottom:"10px",width:"50%"},size:"small",value:n,type:u?"text":"password",onChange:v=>{c(v.target.value),i.oldPassword=v.target.value},required:!0,id:"passwordOld",label:"Old password",FormHelperTextProps:{sx:{color:"red",maxWidth:320}},color:"primary",InputProps:{endAdornment:a.jsx(me,{position:"end",children:a.jsx(Y,{"aria-label":"toggle password visibility",onClick:r,edge:"end",children:u?a.jsx(ve,{}):a.jsx(Ce,{})})})}}),a.jsx(D,{value:d,autoComplete:"off",style:{marginBottom:"10px",width:"50%"},size:"small",type:m?"text":"password",onChange:v=>y(v.target.value),required:!0,id:"passwordNew",label:"New password",helperText:t?"":p,FormHelperTextProps:{sx:{color:"red",maxWidth:320}},color:t?"primary":"error",InputProps:{endAdornment:a.jsx(me,{position:"end",children:a.jsx(Y,{"aria-label":"toggle password visibility",onClick:j,edge:"end",children:m?a.jsx(ve,{}):a.jsx(Ce,{})})})}}),z&&a.jsx(B,{className:"change-icon"})]})}var ie={},as=J;Object.defineProperty(ie,"__esModule",{value:!0});var be=ie.default=void 0,ts=as(K()),is=a;be=ie.default=(0,ts.default)((0,is.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function ls(e,u){const C={id:e,value:{streetName:{value:"",isValid:!1},city:{value:"",isValid:!1},postalCode:{value:"",isValid:!1},country:{value:"",isValid:!1}}};return u.find(m=>m.id===e)||u.push(C),{id:e,streetName:"",postalCode:"",country:"",city:""}}function ds({cityProps:e}){var f;const[u,C]=l.useState(!0),[m,h]=l.useState(""),[t,s]=l.useState(""),n=l.useContext(A),c=I(r=>r.auth.user),d=c==null?void 0:c.addresses.find(({id:r})=>e.addressId===r),o=(f=n.addresses)==null?void 0:f.find(r=>e.addressId===r.id);l.useEffect(()=>{const r=(o==null?void 0:o.value.city.value)||(d==null?void 0:d.city)||"";s(r)},[o,d]);function i(r){s(r),C(!b("city",r)),h(b("city",r)),o!=null&&o.value.city&&(o.value.city.value=r,o.value.city.isValid=!b("city",r))}const p=t!==((d==null?void 0:d.city)||"");return a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{className:"input-field-profile",disabled:e.isDisable,value:t,autoComplete:"off",type:"Text",size:"small",style:{marginBottom:"10px"},required:!0,onChange:r=>i(r.target.value),label:"City",helperText:u?"":m,FormHelperTextProps:{sx:{color:"red"}},color:u?"primary":"error"}),p&&a.jsx(B,{className:`change-icon-address ${e.type==="shipping"?"right-zero":"left-zero"}`})]})}function Se(e){switch(e){case"DE":return"Germany";case"CA":return"Canada";case"US":return"USA";case"GB":return"Great Britain";default:return""}}function ns({countryProps:e}){var i;const u=["Great Britain","Germany","Canada","USA"],C=l.useContext(A),m=I(p=>p.auth.user),h=m==null?void 0:m.addresses.find(({id:p})=>e.addressId===p),[t,s]=l.useState(Se(h==null?void 0:h.country)),[n,c]=l.useState(!1),d=(i=C.addresses)==null?void 0:i.find(p=>e.addressId===p.id);function o(p){d!=null&&d.value&&(s(p),d.value.country.value=p,d.value.country.isValid=!0,e.isUpdate(e.type),c(F(d==null?void 0:d.value.country.value)!==(h==null?void 0:h.country)))}return a.jsxs("div",{className:"field-wrap",children:[a.jsxs(Z,{className:"input-field-profile",size:"small",children:[a.jsx(Ee,{id:"country_select",children:"Country"}),a.jsx(Pe,{disabled:e.isDisable,style:{marginBottom:"10px"},labelId:"country_select",label:"Country",value:t??" ",defaultValue:Se(h==null?void 0:h.country),required:!0,onChange:p=>o(p.target.value),children:u.map(p=>a.jsx(De,{value:p,children:p},p))})]}),n&&a.jsx(B,{className:`change-icon-address ${e.type==="shipping"?"right-zero":"left-zero"}`})]})}function rs({postalProps:e}){var f;const u=l.useContext(A),[C,m]=l.useState(!0),h=I(r=>r.auth.user),t=h==null?void 0:h.addresses.find(({id:r})=>e.addressId===r),s=(f=u.addresses)==null?void 0:f.find(r=>e.addressId===r.id),n=(s==null?void 0:s.value.postalCode.value)||(t==null?void 0:t.postalCode)||"",[c,d]=l.useState(n);l.useEffect(()=>(s!=null&&s.value.postalCode&&(s.value.postalCode.value=t==null?void 0:t.postalCode,d(s.value.postalCode.value)),()=>{d("")}),[h,t]);function o(r,j){s!=null&&s.value&&(s.value.postalCode.isValid=ge(r,j),s.value.postalCode.value=r)}function i(r){d(r);const j=s==null?void 0:s.value.country.value;if(s!=null&&s.value&&(s.value.postalCode.value=r),typeof j=="string"&&j.length>1){const y=F(j);m(ge(r,y)),o(r,y)}}l.useEffect(()=>{i(c)},[e.isChange,s==null?void 0:s.value.country.value]);const p=c!==((t==null?void 0:t.postalCode)||"");return a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{className:"input-field-profile",disabled:e.isDisable,value:c,autoComplete:"off",type:"Text",style:{marginBottom:"10px"},required:!0,size:"small",onChange:r=>i(r.target.value),label:e.profilePostalCode?"":"Postal Code",helperText:C?"":"Enter valid postal code",FormHelperTextProps:{sx:{color:"red"}},color:C?"primary":"error"}),p&&a.jsx(B,{className:`change-icon-address ${e.type==="shipping"?"right-zero":"left-zero"}`})]})}function os({streetProps:e}){var f;const[u,C]=l.useState(!0),[m,h]=l.useState(""),[t,s]=l.useState(""),n=I(r=>r.auth.user),c=n==null?void 0:n.addresses.find(({id:r})=>e.addressId===r),o=(f=l.useContext(A).addresses)==null?void 0:f.find(r=>e.addressId===r.id);l.useEffect(()=>{const r=(o==null?void 0:o.value.streetName.value)||(c==null?void 0:c.streetName)||"";s(r)},[o,c]);function i(r){s(r),C(!b("street",r)),h(b("street",r)),o!=null&&o.value.streetName&&(o.value.streetName.value=r,o.value.streetName.isValid=!b("street",r))}const p=t!==((c==null?void 0:c.streetName)||"");return a.jsxs("div",{className:"field-wrap",children:[a.jsx(D,{className:"input-field-profile",disabled:e.isDisable,value:t,autoComplete:"off",type:"Text",size:"small",style:{marginBottom:"10px"},required:!0,onChange:r=>i(r.target.value),label:"Street",helperText:u?"":m,FormHelperTextProps:{sx:{color:"red"}},color:u?"primary":"error"}),p&&a.jsx(B,{className:`change-icon-address ${e.type==="shipping"?"right-zero":"left-zero"}`})]})}function Ne({type:e,addressId:u,index:C,isDisable:m}){var v,E;const h=ye(),t=I(S=>S.auth.user),s=l.useContext(A),[n,c]=l.useState(!1);let d=t==null?void 0:t.addresses.find(S=>S.id===u);(u==="newShippingAddress"||u==="newBillingAddress")&&s.addresses&&(d=ls(u,s.addresses));const o=(E=(v=s.addresses)==null?void 0:v.find(S=>S.id===u))==null?void 0:E.value,[i,p]=l.useState(!!(t!=null&&t.defaultBillingAddressId)),[f,r]=l.useState(!!(t!=null&&t.defaultShippingAddressId));l.useEffect(()=>{if(o){const S=Object.values(o).every(O=>O.isValid),M=Object.entries(o).some(O=>{const[_,$]=O,T=_==="country"?F($.value):$.value;return typeof _=="string"&&d?T!==d[_]:!1});c(S&&M)}},[o==null?void 0:o.city.value,o==null?void 0:o.postalCode.value,o==null?void 0:o.streetName.value,o==null?void 0:o.country.value]);const j=()=>{switch(e){case"shipping":{r(!f);break}case"billing":{p(!i);break}}};async function y(){let S;typeof(t==null?void 0:t.id)=="string"&&typeof(t==null?void 0:t.version)=="number"&&(S=await P.removeAddress(u,t.id,t.version)),(S==null?void 0:S.statusCode)===200&&(L("Address removed success"),h(q({user:S.body})),s.addresses&&(s.addresses=s.addresses.filter(M=>M.id!==u)))}async function z(){let S;if(typeof(t==null?void 0:t.id)=="string"&&typeof(t==null?void 0:t.version)=="number"){if(!o)return null;const M=Object.entries(o).reduce((O,_)=>{const[$,T]=_,H=$===V.country?F(T.value):T.value,G={[$]:H};return{...O,...G}},{});S=await P.changeAddress(M,u,t.id,t.version),(S==null?void 0:S.statusCode)===200&&(L("address updated"),h(q({user:S.body})),c(!1))}return null}return a.jsxs("div",{className:"data-field-input",children:[a.jsx("p",{children:`${C+1} Address`}),u!=="newShippingAddress"&&u!=="newBillingAddress"&&a.jsxs("div",{className:"label-address-wrap",children:[a.jsx(ee,{control:a.jsx(Te,{value:u}),label:" default address"}),n&&a.jsx(Y,{onClick:()=>z(),"aria-label":"delete",children:a.jsx(W,{})}),!m&&a.jsx(Y,{onClick:()=>y(),"aria-label":"delete",children:a.jsx(be,{})})]}),a.jsx(os,{streetProps:{type:e,profileStreet:d!=null&&d.streetName?d.streetName:"",isDisable:m,addressId:u}}),a.jsx(ds,{cityProps:{type:e,profileCity:d==null?void 0:d.city,isDisable:m,addressId:u}}),a.jsx(rs,{postalProps:{isChange:f,type:e,profilePostalCode:d==null?void 0:d.postalCode,isDisable:m,addressId:u}}),a.jsx(ns,{countryProps:{isUpdate:()=>j,type:e,profileCountry:d==null?void 0:d.country,isDisable:m,addressId:u}})]})}async function us(e,u,C,m,h){var o;const t=`new${je(u)}Address`,s=e.addresses,n=s==null?void 0:s.find(i=>i.id===t);if(!n)return null;const c=Object.entries(n.value).reduce((i,p)=>{const[f,r]=p,j=f===V.country?F(r.value):r.value,y={[f]:j};return{...i,...y}},{}),d=await P.addNewAddress(C,m,c);if((d==null?void 0:d.statusCode)===200){const{addresses:i}=d.body,p=(o=i.find(({streetName:j,postalCode:y,city:z})=>c.streetName===j&&c.postalCode===y&&c.city===z))==null?void 0:o.id;if(!p)return null;const f=d.body.version,r=await P.setShippingOrBillingAddress(C,p,f,u);if((r==null?void 0:r.statusCode)===200)return h(q({user:r.body})),n.id=p,L(`new ${u} address created`),r}return null}function we(e){const u={streetName:{value:e.streetName,isValid:!0},city:{value:e.city,isValid:!0},country:{value:e.country,isValid:!0},postalCode:{value:e.postalCode,isValid:!0}};return{id:e.id,value:u}}function ms(){var re,oe,ue,ce,fe;const e=I(g=>g.auth.user),u=ye(),[C,m]=l.useState(!0),[h,t]=l.useState(!0),[s,n]=l.useState(!1),[c,d]=l.useState(!1),[o,i]=l.useState(!1),[p,f]=l.useState(!1),[r,j]=l.useState((e==null?void 0:e.defaultBillingAddressId)||""),[y,z]=l.useState((e==null?void 0:e.defaultShippingAddressId)||""),v=l.useContext(A);v.defaultBillingAddressId=e!=null&&e.defaultBillingAddressId?e==null?void 0:e.defaultBillingAddressId:"",v.defaultShippingAddressId=e!=null&&e.defaultShippingAddressId?e==null?void 0:e.defaultShippingAddressId:"";const[E,S]=l.useState(!1),[M,O]=l.useState(!1),[_,$]=l.useState(!1),[T,H]=l.useState((e==null?void 0:e.shippingAddressIds)||[]),[G,Q]=l.useState((e==null?void 0:e.billingAddressIds)||[]);function Ve(){S(!E)}l.useEffect(()=>{S(!E)},[E]),l.useEffect(()=>{var g;O(!!((g=v.fieldChangedSet)!=null&&g.size))},[(re=v.fieldChangedSet)==null?void 0:re.size]),l.useEffect(()=>{var g;$(!!((g=v.fieldChangedSetAddr)!=null&&g.size))},[(oe=v.fieldChangedSetAddr)==null?void 0:oe.size]),l.useEffect(()=>{var x,N;Q((e==null?void 0:e.billingAddressIds)||[]);const g=(x=v.addresses)==null?void 0:x.findIndex(w=>w.id==='"newBillingAddress"');g&&((N=v.addresses)==null||N.splice(g,1))},[(ue=e==null?void 0:e.billingAddressIds)==null?void 0:ue.length]),l.useEffect(()=>{var x,N;H((e==null?void 0:e.shippingAddressIds)||[]);const g=(x=v.addresses)==null?void 0:x.findIndex(w=>w.id==='"newShippingAddress"');g&&((N=v.addresses)==null||N.splice(g,1))},[(ce=e==null?void 0:e.shippingAddressIds)==null?void 0:ce.length]),l.useEffect(()=>{t(!0)},[(fe=e==null?void 0:e.addresses)==null?void 0:fe.length]),l.useEffect(()=>{v.addresses&&(e!=null&&e.addresses)&&(v.addresses=e==null?void 0:e.addresses.reduce((g,x)=>(v.addresses&&g.push(we(x)),g),[]),Q((e==null?void 0:e.billingAddressIds)||[]),H((e==null?void 0:e.shippingAddressIds)||[])),n(!1),d(!1),i(!1),f(!1)},[h]),l.useEffect(()=>(v.addresses=e==null?void 0:e.addresses.reduce((g,x)=>(v.addresses&&g.push(we(x)),g),[]),()=>{}),[]);function Ae(){const g=v.addresses;if(!g)return;const x=g.find(w=>w.id==="newShippingAddress");if(x){const w=Object.values(x.value).every(X=>X.isValid);i(w)}const N=g.find(w=>w.id==="newBillingAddress");if(N){const w=Object.values(N.value).every(X=>X.isValid);f(w)}}function Ie(){}function cs(){}async function Be(){await Ye(v,e==null?void 0:e.id,e==null?void 0:e.version,u),v.fieldChangedSet=new Set,m(!0)}function le(g){const x=v.addresses;let N=!1,w=!1;g==="billing"?(c&&x?N=!0:c||(Q([...G,"newBillingAddress"]),N=!0),N&&d(!c)):(s&&x||H([...T,"newShippingAddress"]),w=!0,w&&n(!s))}async function de(g){if(e){const x=await us(v,g,e.id,e.version,u);(x==null?void 0:x.statusCode)===200&&g==="shipping"&&(n(!1),i(!1),t(!0)),(x==null?void 0:x.statusCode)===200&&g==="billing"&&(d(!1),f(!1),t(!0))}}async function ne(g,x){const N=g.target.value;if(!N||!(e!=null&&e.id)||!(e!=null&&e.version))return null;let w;return x==="shipping"&&(z(N),w=await P.setDefaultShippingAddr(N,e.id,e.version)),x==="billing"&&(j(N),w=await P.setDefaultBillingAddr(N,e.id,e.version)),(w==null?void 0:w.statusCode)===200&&(L(`default ${x} address changed`),u(q({user:w.body})),t(!0)),null}return a.jsxs(a.Fragment,{children:[a.jsx(ze,{className:"page-title",variant:"h2",children:"Profile"}),a.jsx("div",{className:"profile-wrapper",children:a.jsx(A.Provider,{value:v,children:a.jsxs("div",{className:"profile-form-field",children:[a.jsx(pe,{elevation:24,className:"profile-paper",children:a.jsxs("form",{className:"profile-form",onChange:Ie,children:[a.jsxs("div",{className:"switcher-wrap",children:[a.jsx(ee,{control:a.jsx(he,{sx:{ml:".5rem"},checked:!C,className:"disable-switch",onChange:()=>m(!C)}),label:C?"Edit user data":"Cancel data editing"}),a.jsxs(Y,{size:"large",className:`save-icon ${M?"save-visible":"save-unvisible"}`,onClick:()=>Be(),children:[a.jsx(W,{}),"save"]})]}),a.jsxs("div",{className:"user-field-profile",children:["User Data",a.jsx(Xe,{isDisable:C}),a.jsx(Ze,{isDisable:C}),a.jsx(es,{isDisable:C}),a.jsx(Qe,{dateProps:{isChange:Ve,isDisable:C}}),a.jsx(ss,{isDisable:C})]})]})}),a.jsx(pe,{elevation:24,className:"profile-paper",children:a.jsx("form",{className:"profile-form",onChange:Ae,children:a.jsxs("div",{className:"address-field",children:[a.jsxs("div",{className:"switcher-wrap",children:[a.jsx(ee,{control:a.jsx(he,{sx:{ml:".5rem"},checked:!h,className:"disable-switch",onChange:()=>t(!h)}),label:h?"Edit address data":"Cancel data editing"}),a.jsxs(U,{size:"large",className:`save-icon ${_?"save-visible":"save-unvisible"}`,onClick:()=>void 0,children:[a.jsx(W,{}),"save"]})]}),a.jsxs("div",{className:"address-input-field",children:[a.jsx(Z,{className:"data-field-profile",disabled:h,children:a.jsxs(xe,{defaultValue:e!=null&&e.defaultBillingAddressId?e.defaultBillingAddressId:"",value:r,onChange:g=>ne(g,"billing"),"aria-labelledby":"radio-buttons-group-label",name:"radio-buttons-billing",children:[a.jsxs("ul",{className:"data-field-list",children:[a.jsx("p",{children:" Billing Addresses"}),G.map((g,x)=>a.jsx("li",{children:(e==null?void 0:e.addresses.find(N=>N.id===g||g==="newBillingAddress"))&&a.jsx(Ne,{type:"billing",addressId:g,index:x,isDisable:h})},g))]}),!c&&!h&&a.jsx(U,{onClick:()=>le("billing"),className:"add-address-button",variant:"outlined",startIcon:a.jsx(R,{}),children:"Add billing address"}),c&&p&&a.jsx(U,{onClick:()=>de("billing"),className:"add-address-button",variant:"outlined",startIcon:a.jsx(R,{}),children:"Save billing address"})]})}),a.jsx(Z,{className:"data-field-profile",disabled:h,children:a.jsxs(xe,{defaultValue:e==null?void 0:e.defaultShippingAddressId,value:y,onChange:g=>ne(g,"shipping"),"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-shipping",children:[a.jsxs("ul",{className:"data-field-list",children:[a.jsx("p",{children:" Shipping Addresses"}),T.map((g,x)=>a.jsx("li",{children:(e==null?void 0:e.addresses.find(N=>N.id===g||g==="newShippingAddress"))&&a.jsx(Ne,{type:"shipping",addressId:g,index:x,isDisable:h})},g))]}),s&&o&&a.jsx(U,{onClick:()=>de("shipping"),className:"add-address-button",variant:"outlined",startIcon:a.jsx(R,{}),children:"Save shipping address"}),!s&&!h&&a.jsx(U,{onClick:()=>le("shipping"),className:"add-address-button",variant:"outlined",startIcon:a.jsx(R,{}),children:"Add shipping address"})]})})]})]})})})]})})})]})}export{ms as default};
