import{d as u,b as O,i as R,j as t,e as $,u as q,r as n,U as Q,bt as G,V as W,T as I,bc as U,I as V,dg as Y,dl as _,di as H,l as N,dc as J,B as d,a as K}from"./index-CTuUUjIM.js";import{d as X}from"./ArrowBack-B0RvuiGv.js";import{D as F,b as B,a as T}from"./DialogTitle-B51e1Fuq.js";async function p(){let a;const m=localStorage.getItem("cartId");return!localStorage.getItem("tokenCacheGG")&&m?a=await u.getCartById(m):a=await u.getActiveCart(),a==null?void 0:a.body}var A={},Z=R;Object.defineProperty(A,"__esModule",{value:!0});var z=A.default=void 0,tt=Z(O()),et=t;z=A.default=(0,tt.default)((0,et.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft");var S={},at=R;Object.defineProperty(S,"__esModule",{value:!0});var L=S.default=void 0,st=at(O()),ot=t;L=S.default=(0,st.default)((0,ot.jsx)("path",{d:"m10 17 5-5-5-5z"}),"ArrowRight");function it({item:a,recalculate:m}){const y=$(c=>c.auth.isLoggedIn),v=q(),b=a.variant.images&&a.variant.images[0].url,[i,f]=n.useState(a.quantity),[P,j]=n.useState(a.price.value.centAmount),[k,C]=n.useState(a.totalPrice.centAmount);async function x(c){const l=await H(y),g=l==null?void 0:l.body;if(g){const o=await u.changeItemQuantity(g.id,g.version,a.id,c),r=o==null?void 0:o.body.lineItems.filter(w=>w.id===a.id);m(),(o==null?void 0:o.statusCode)===200&&v(N({cart:o.body})),r&&r.length&&(C(r[0].totalPrice.centAmount),j(r[0].price.value.centAmount))}}const h=c=>{switch(c){case"up":{f(i+1),x(i+1);break}case"down":{i===1&&_("Removed from cart"),f(i-1),x(i-1);break}case"zero":{f(0),x(0),_("Removed from cart");break}}};return t.jsxs(Q,{elevation:24,className:"cart-item",children:[t.jsx(G,{className:"cart-item-img",image:b,title:a.name.en}),t.jsxs(W,{className:"cart-item-content",children:[t.jsx(I,{gutterBottom:!0,variant:"body1",component:"div",fontFamily:"Montserrat, sans-serif",textAlign:"left",children:a.variant.key}),t.jsxs("div",{className:"cart-item-data",children:[t.jsxs("div",{className:"cart-item-count",children:[t.jsx(z,{className:"cart-item-arrow",onClick:()=>h("down")}),t.jsx("div",{className:"cart-item-quantity",children:i}),t.jsx(L,{className:"cart-item-arrow",onClick:()=>h("up")})]}),t.jsxs("div",{className:"cart-item-cost",children:["per item:"," ",t.jsxs("b",{children:["$",(P/100).toFixed(2)]})]}),t.jsxs("div",{className:"cart-item-cost",children:["total:"," ",t.jsxs("b",{children:["$",(k/100).toFixed(2)]})]}),t.jsx(U,{title:"Remove from cart",children:t.jsx(V,{onClick:()=>h("zero"),children:t.jsx(Y,{})})})]})]})]})}function lt(){const a=$(e=>{var s;return(s=e.cart.cart)==null?void 0:s.lineItems}),[m,y]=n.useState(0),[v,b]=n.useState(0),i=q(),f=J(),[P,j]=n.useState(!1),[k,C]=n.useState(!1),[x,h]=n.useState(""),c=()=>{j(!0)},l=()=>{j(!1)},g=()=>{C(!0)},o=()=>{C(!1),h("")};function r(e){y(+(e.totalPrice.centAmount/100).toFixed(2)),b(e.discountOnTotalPrice?+((e.discountOnTotalPrice.discountedAmount.centAmount+ +e.totalPrice.centAmount)/100).toFixed(2):0)}async function w(){const e=await p();e&&(i(N({cart:e})),r(e))}const M=async()=>{const e=await p();if(e){const s=await u.recalculateTotalCost(e==null?void 0:e.id,e==null?void 0:e.version);s&&r(s.body)}},D=async()=>{const e=await p();e&&await u.removeCart(e==null?void 0:e.id,e.version),await u.createCart().then(s=>{localStorage.setItem("cartId",s==null?void 0:s.body.id),(s==null?void 0:s.statusCode)===201&&i(N({cart:s.body}))})},E=async()=>{const e=await p();if(e){const s=await u.applyPromocode(e==null?void 0:e.id,e==null?void 0:e.version,x);(s==null?void 0:s.statusCode)===200&&r(s.body)}};return n.useEffect(()=>{w()},[]),t.jsxs("div",{className:"basket-page",children:[t.jsx(I,{className:"page-title",variant:"h2",children:"Basket"}),a&&a.length?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"basket-header",children:[t.jsxs("h3",{children:["Total cost: ",v?t.jsxs("span",{style:{color:"red",fontFamily:"monospace",fontSize:"20px",fontWeight:600,textDecorationLine:"line-through"},children:["$",v]}):""," ",t.jsxs("span",{style:{fontFamily:"monospace",fontSize:"20px",fontWeight:600},children:["$",m]})]}),t.jsxs("div",{className:"basket-header-buttons",children:[t.jsx(d,{sx:{marginRight:"5px"},onClick:g,variant:"contained",children:"Apply Promo"}),t.jsxs(F,{open:k,onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[t.jsx(B,{id:"alert-dialog-title",children:"Do you have Promo?"}),t.jsx(K,{color:"success",focused:!0,sx:{margin:"10px"},value:x,onChange:e=>{h(e.target.value)}}),t.jsxs(T,{children:[t.jsx(d,{sx:{margin:"10px"},onClick:o,children:"Close"}),t.jsx(d,{sx:{margin:"10px"},onClick:()=>{o(),E()},autoFocus:!0,children:"Apply promo"})]})]}),t.jsx(d,{onClick:c,variant:"contained",children:"Clear Basket"}),t.jsxs(F,{open:P,onClose:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[t.jsx(B,{id:"alert-dialog-title",children:"Clear cart?"}),t.jsxs(T,{children:[t.jsx(d,{sx:{margin:"10px"},onClick:l,children:"No"}),t.jsx(d,{sx:{margin:"10px"},onClick:()=>{l(),D()},autoFocus:!0,children:"Yes"})]})]})]})]}),a.map(e=>t.jsx(it,{item:e,recalculate:M},e.id))]}):t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"no-item",fontFamily:"Montserrat, sans-serif",variant:"h4",children:"No items..."}),t.jsx(d,{startIcon:t.jsx(X,{}),sx:{width:"250px"},onClick:()=>f("/catalog"),variant:"contained",children:"Back to catalog"})]})]})}export{lt as default};
