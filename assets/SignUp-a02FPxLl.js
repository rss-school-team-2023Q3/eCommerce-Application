import{r as t,j as s,a as m,F as G,f as O,S as R,M as W,I as J,u as K,T as Q,P as X,g as b,B as Z,N as ee,t as se,k as te}from"./index-CTuUUjIM.js";import{s as ie}from"./signInStoreLogic-CHo_p6Q8.js";import{d as j,L as ae,A as le,D as re,v as S,s as F,p as x}from"./main-D4x9Xeqy.js";import{v as p,d as ne,a as oe}from"./validate-BfdLEKTZ.js";import{I as ue}from"./InputAdornment-CzCEp_rC.js";import{C as V}from"./Checkbox-CATPgQ0w.js";import"./visuallyHidden-Dan1xhjv.js";const N={email:{value:"",isValid:!1},password:{value:"",isValid:!1},name:{value:"",isValid:!1},lastName:{value:"",isValid:!1},date:{value:j(""),isValid:!1},billingStreet:{value:"",isValid:!1},shippingStreet:{value:"",isValid:!1},billingCity:{value:"",isValid:!1},shippingCity:{value:"",isValid:!1},billingCode:{value:"",isValid:!1},shippingCode:{value:"",isValid:!1},billingCountry:{value:"",isValid:!1},shippingCountry:{value:"",isValid:!1}},g=t.createContext(structuredClone(N));function P({cityProps:i}){const[l,o]=t.useState(!0),[d,e]=t.useState(""),n=t.useContext(g);function a(u){switch(o(!p("city",u)),e(p("city",u)),!p("city",u)){case!0:{i.type==="shipping"?(n.shippingCity.value=u,n.shippingCity.isValid=!0):(n.billingCity.value=u,n.billingCity.isValid=!0);break}default:{i.type==="shipping"?n.shippingCity.isValid=!1:n.billingCity.isValid=!1;break}}}return s.jsx(m,{autoComplete:"off",type:"Text",size:"small",style:{marginBottom:"10px"},required:!0,onChange:u=>a(u.target.value),label:"City",helperText:l?"":d,FormHelperTextProps:{sx:{color:"red"}},color:l?"primary":"error"})}function T({countryProps:i}){const l=["Great Britain","Germany","Canada","USA"],o=t.useContext(g);function d(e){switch(i.isUpdate(i.type),i.type){case"billing":{o.billingCountry.value=e,o.billingCountry.isValid=!0;break}case"shipping":{o.shippingCountry.value=e,o.shippingCountry.isValid=!0;break}}}return s.jsxs(G,{size:"small",children:[s.jsx(O,{id:"country_select",children:"Country"}),s.jsx(R,{style:{marginBottom:"10px"},labelId:"country_select",label:"Country",defaultValue:"",required:!0,onChange:e=>d(e.target.value),children:l.map(e=>s.jsx(W,{value:e,children:e},e))})]})}function de({dateProps:i}){j.locale("ru");const l=j().subtract(15,"y"),[o,d]=t.useState(!0),[e,n]=t.useState(""),a=t.useContext(g);function u(c){i.isChange(!0),d(!S(c)),n(S(c)),S(c)?a.date.isValid=!1:(a.date.value=c,a.date.isValid=!0),i.isChange(!1)}return s.jsx(ae,{dateAdapter:le,adapterLocale:"ru",children:s.jsx(re,{style:{marginBottom:"10px"},label:"Date of birth",required:!0,maxDate:l,helperText:o?"":e,FormHelperTextProps:{sx:{color:"red"}},size:"small",onChange:c=>u(c)})})}function pe(){const[i,l]=t.useState(!0),[o,d]=t.useState(""),e=t.useContext(g);function n(a){l(!p("email",a)),d(p("email",a)),!p("email",a)&&a.length>1?(e.email.value=a,e.email.isValid=!0):e.email.isValid=!1}return s.jsx(m,{type:"email",id:"email",label:"Email",autoComplete:"off",style:{marginBottom:"10px"},required:!0,helperText:i?"":o,FormHelperTextProps:{sx:{color:"red"}},color:i?"primary":"error",size:"small",onChange:a=>n(a.target.value)})}function ce(){const[i,l]=t.useState(!0),[o,d]=t.useState(""),e=t.useContext(g);function n(a){l(!p("name",a)),d(p("name",a)),p("name",a)?e.name.isValid=!1:(e.name.value=a,e.name.isValid=!0)}return s.jsx(m,{id:"first_name",label:"First Name",autoComplete:"off",type:"Text",style:{marginBottom:"10px"},required:!0,helperText:i?"":o,FormHelperTextProps:{sx:{color:"red"}},color:i?"primary":"error",size:"small",onChange:a=>n(a.target.value)})}function ge(){const[i,l]=t.useState(!0),[o,d]=t.useState(""),e=t.useContext(g);function n(a){l(!p("lastName",a)),d(p("lastName",a)),p("lastName",a)?e.lastName.isValid=!1:(e.lastName.value=a,e.lastName.isValid=!0)}return s.jsx(m,{id:"last_name",label:"Last Name",autoComplete:"off",type:"Text",style:{marginBottom:"10px"},helperText:i?"":o,FormHelperTextProps:{sx:{color:"red"}},color:i?"primary":"error",required:!0,size:"small",onChange:a=>n(a.target.value)})}function fe(){const[i,l]=t.useState(!1),[o,d]=t.useState(!0),e=t.useContext(g),[n,a]=t.useState(""),u=()=>{l(r=>!r)};function c(r){d(!p("password",r)),a(p("password",r)),!p("password",r)&&r.length>1?(e.password.value=r,e.password.isValid=!0):e.password.isValid=!1}return s.jsx(m,{autoComplete:"off",style:{marginBottom:"10px"},size:"small",type:i?"text":"password",onChange:r=>c(r.target.value),required:!0,id:"password",label:"Password",helperText:o?"":n,FormHelperTextProps:{sx:{color:"red",maxWidth:320}},color:o?"primary":"error",InputProps:{endAdornment:s.jsx(ue,{position:"end",children:s.jsx(J,{"aria-label":"toggle password visibility",onClick:u,edge:"end",children:i?s.jsx(ne,{}):s.jsx(oe,{})})})}})}function B({postalProps:i}){const l=t.useContext(g),[o,d]=t.useState(!0),e=i.type==="shipping"?l.shippingCountry.value:l.billingCountry.value,[n,a]=t.useState("1");function u(r,f,h){x(r,f)&&h==="shipping"?(l.shippingCode.value=r,l.shippingCode.isValid=!0):x(r,f)&&h==="billing"?(l.billingCode.value=r,l.billingCode.isValid=!0):!x(r,f)&&h==="billing"?l.billingCode.isValid=!1:!x(r,f)&&h==="shipping"&&(l.shippingCode.isValid=!1)}function c(r){if(a(r),typeof e=="string"&&e.length>1){const f=F(e);d(x(r,f)),u(r,f,i.type)}}return t.useEffect(()=>{c(n)},[i.isChange]),s.jsx(m,{autoComplete:"off",type:"Text",style:{marginBottom:"10px"},required:!0,size:"small",onChange:r=>c(r.target.value),label:"Postal Code",helperText:o?"":"Enter valid postal code",FormHelperTextProps:{sx:{color:"red"}},color:o?"primary":"error"})}function A({streetProps:i}){const[l,o]=t.useState(!0),[d,e]=t.useState(""),n=t.useContext(g);function a(u){switch(o(!p("street",u)),e(p("street",u)),!p("street",u)){case!0:{i.type==="shipping"?(n.shippingStreet.value=u,n.shippingStreet.isValid=!0):(n.billingStreet.value=u,n.billingStreet.isValid=!0);break}default:i.type==="shipping"?n.shippingStreet.isValid=!1:n.billingStreet.isValid=!1}}return s.jsx(m,{autoComplete:"off",type:"Text",size:"small",style:{marginBottom:"10px"},required:!0,onChange:u=>a(u.target.value),label:"Street",helperText:l?"":d,FormHelperTextProps:{sx:{color:"red"}},color:l?"primary":"error"})}const M=(i,l)=>({country:F(i[`${l}Country`].value),city:i[`${l}City`].value,postalCode:i[`${l}Code`].value,streetName:i[`${l}Street`].value});function Se({client:i}){const l=K(),[o,d]=t.useState(!1);let e=t.useContext(g);const[n,a]=t.useState(!1),[u,c]=t.useState(!1),[r,f]=t.useState(!1),[h,z]=t.useState(!1),[y,U]=t.useState(!1),[w,L]=t.useState(!1);function D(){d(Object.values(e).every(C=>C.isValid))}function q(){switch(r){case!0:{e.shippingCode.value=" ",e.shippingCode.isValid=!1,e.shippingStreet.value=" ",e.shippingStreet.isValid=!1,e.shippingCity.value=" ",e.shippingCity.isValid=!1,e.shippingCountry.value=" ",e.shippingCountry.isValid=!1;break}case!1:{e.shippingCode.value=e.billingCode.value,e.shippingCode.isValid=!0,e.shippingStreet.value=e.billingStreet.value,e.shippingStreet.isValid=!0,e.shippingCity.value=e.billingCity.value,e.shippingCity.isValid=!0,e.shippingCountry.value=e.billingCountry.value,e.shippingCountry.isValid=!0;break}}f(!r)}const H=async C=>{C.preventDefault();let $;const I={billingCountry:{value:e.billingCountry.value},billingCity:{value:e.billingCity.value},billingCode:{value:e.billingCode.value},billingStreet:{value:e.billingStreet.value},shippingCountry:{value:e.shippingCountry.value},shippingCity:{value:e.shippingCity.value},shippingCode:{value:e.shippingCode.value},shippingStreet:{value:e.shippingStreet.value}},Y=[M(I,"billing"),M(I,"shipping")];if(o){const v={email:e.email.value,password:e.password.value,firstName:e.name.value,lastName:e.lastName.value,dateOfBirth:e.date.value.format("YYYY-MM-DD"),addresses:Y,billingAddresses:[0],shippingAddresses:[1],...y&&{defaultBillingAddress:0},...r?y&&{defaultShippingAddress:1}:h&&{defaultShippingAddress:1}};try{await i.registerUser(v),await ie(v.email,v.password,l),se("User created")}catch(E){E instanceof Error&&te(E.message)}}return $},k=C=>{switch(C){case"shipping":{c(!u);break}case"billing":{a(!n);break}}};function _(){L(!w)}return t.useEffect(()=>(e=structuredClone(N),()=>{e=structuredClone(N)}),[]),t.useEffect(()=>{D()},[n,u,w]),s.jsxs("div",{className:"registration-wrapper",children:[s.jsx(Q,{className:"page-title",variant:"h2",children:"Register"}),s.jsxs(X,{className:"registration-paper",elevation:24,children:[s.jsx(g.Provider,{value:e,children:s.jsxs("form",{className:"registration-form",action:"registration",onChange:D,children:[s.jsxs("div",{className:"registration-form-field",children:[s.jsxs("div",{className:r?"user-field fifty-percent":"user-field",children:["User Data",s.jsx(pe,{}),s.jsx(ce,{}),s.jsx(ge,{}),s.jsx(de,{dateProps:{isChange:_}}),s.jsx(fe,{})]}),s.jsxs("div",{className:r?"adress-field fifty-percent":"adress-field",children:[s.jsxs("div",{className:r?"adress-input-field hundred-percent":"adress-input-field",children:[s.jsxs("div",{className:r?"data-field hundred-percent":"data-field",children:[r?"Billing & Shipping Adress":"Billing Adress",s.jsx(A,{streetProps:{type:"billing"}}),s.jsx(P,{cityProps:{type:"billing"}}),s.jsx(B,{postalProps:{isChange:n,type:"billing"}}),s.jsx(T,{countryProps:{isUpdate:k,type:"billing"}}),s.jsx(b,{className:"switch-field",control:s.jsx(V,{size:"small",checked:y,onChange:()=>U(!y)}),label:"Use as default adress"})]}),r!==!0?s.jsxs("div",{className:"data-field",children:["Shipping Adress",s.jsx(A,{streetProps:{type:"shipping"}}),s.jsx(P,{cityProps:{type:"shipping"}}),s.jsx(B,{postalProps:{isChange:u,type:"shipping"}}),s.jsx(T,{countryProps:{isUpdate:k,type:"shipping"}}),s.jsx(b,{className:"switch-field",control:s.jsx(V,{size:"small",checked:h,onChange:()=>z(!h)}),label:"Use as default adress"})]}):""]}),s.jsx("div",{className:"adress-switch-field",children:s.jsx(b,{className:"switch-field",control:s.jsx(V,{size:"small",checked:r,onChange:()=>q()}),label:"Use same billing & shipping adress"})})]})]}),s.jsx(Z,{variant:"contained",color:o?"primary":"error",onClick:H,children:"Sign Up"})]})}),s.jsx("div",{children:s.jsx(ee,{className:"login-link",to:"/signin",children:"Already have an account? Sign In"})})]})]})}export{Se as default};
